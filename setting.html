<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MantaMind Settings</title>
  <link rel="stylesheet" href="Styles/style.css" />
<link rel="stylesheet" href="Styles/nav.css" />
<link rel="stylesheet" href="Styles/settings.css" />

</head>
<body>

  <!-- Top Navigation Bar -->
  <header id="top-nav">
    <div id="nav-title">ğŸ§  MantaMind</div>
    <button id="burger-btn">&#9776;</button>
  </header>

  <!-- Sidebar Menu -->
  <nav id="sidebar-menu" class="hidden">
    <ul>
      <li><a href="index.html">ğŸ‘‹ Home</a></li>
      <li><a href="challenge.html">ğŸ® Challenge</a></li>
      <li><a href="profile.html">ğŸ‘¤ Profile</a></li>
      <li><a href="matching.html">ğŸ§© Matching</a></li>
      <li><a href="wordlist.html">ï¿½ Word List</a></li>
      <li><a href="#" id="logout-btn">ğŸšª Logout</a></li>
    </ul>
  </nav>

  <!-- Settings Section -->
  <main class="game-container">
    <h1>âš™ï¸ Settings</h1>
    <button id="clear-progress">ğŸ§¹ Clear My Progress</button>

    <section class="appearance-settings">
      <h3>Appearance</h3>
      <div class="setting-row">
        <label for="theme-select">Theme color</label>
        <div class="theme-select" id="theme-select">
          <label><input type="radio" name="theme" value="blue" id="theme-blue" /> Blue</label>
          <label><input type="radio" name="theme" value="red" id="theme-red" /> Red</label>
        </div>
      </div>
    </section>

    <section class="question-type-settings">
      <h3>Test Question Types</h3>
      <div class="setting-row">
        <label for="toggle-mc">Multiple choice</label>
        <label class="switch"><input type="checkbox" id="toggle-mc" /><span class="slider"></span></label>
      </div>
      <div class="setting-row">
        <label for="toggle-match">Matching (up to 5 pairs)</label>
        <label class="switch"><input type="checkbox" id="toggle-match" /><span class="slider"></span></label>
      </div>
      <div class="setting-row">
        <label for="toggle-formmatch">Form variants (choose the correct variant)</label>
        <label class="switch"><input type="checkbox" id="toggle-formmatch" /><span class="slider"></span></label>
      </div>

      <div class="setting-row">
        <label for="progress-target">Words-to-learn threshold</label>
        <select id="progress-target">
          <option value="3">3 correct in a row (default)</option>
          <option value="5">5 correct in a row</option>
          <option value="10">10 correct in a row</option>
        </select>
      </div>

      <p class="hint">Tip: Keep matching pairs to 5 or fewer for best UX.</p>
      <button id="save-settings" class="primary">Save settings</button>
    </section>
  </main>

  <script>
    // ğŸ” Burger Menu Toggle
    document.getElementById('burger-btn').addEventListener('click', () => {
      document.getElementById('sidebar-menu').classList.toggle('hidden');
    });

    // ğŸšª Logout Button
    document.getElementById('logout-btn').addEventListener('click', () => {
      localStorage.removeItem('currentUser');
      localStorage.removeItem('userData');
      location.href = 'index.html';
    });

    // ğŸ§¹ Clear Progress
    document.getElementById('clear-progress').addEventListener('click', () => {
      const currentUser = localStorage.getItem('currentUser');
      const userData = JSON.parse(localStorage.getItem('userData') || '{}');

      if (currentUser && userData[currentUser]) {
        userData[currentUser].learnedWords = [];
        userData[currentUser].inProgressWords = [];
        userData[currentUser].correctStreaks = {};
        localStorage.setItem('userData', JSON.stringify(userData));
        alert("Progress cleared!");
      }
    });

    // --- Apply theme helper ---
    function applyTheme(theme) {
      document.body.classList.remove('theme-red');
      if (theme === 'red') document.body.classList.add('theme-red');
    }

    // --- Question type settings persistence ---
    function loadQuestionTypeSettings() {
      const currentUser = localStorage.getItem('currentUser');
      const userData = JSON.parse(localStorage.getItem('userData') || '{}');
      const defaults = { multipleChoice: true, matching: false, formMatch: false, theme: 'blue', progressTarget: 3 };
      const settings = (currentUser && userData[currentUser] && userData[currentUser].settings) || defaults;

      document.getElementById('toggle-mc').checked = !!settings.multipleChoice;
      document.getElementById('toggle-match').checked = !!settings.matching;
      document.getElementById('toggle-formmatch').checked = !!settings.formMatch;

      document.getElementById('theme-blue').checked = (settings.theme === 'blue');
      document.getElementById('theme-red').checked = (settings.theme === 'red');
      applyTheme(settings.theme);

      document.getElementById('progress-target').value = String(settings.progressTarget || 3);

      // apply theme immediately when changed
      document.getElementById('theme-blue').addEventListener('change', () => applyTheme('blue'));
      document.getElementById('theme-red').addEventListener('change', () => applyTheme('red'));
    }

    function saveQuestionTypeSettings() {
      const currentUser = localStorage.getItem('currentUser');
      if (!currentUser) return alert('No user logged in.');
      const userData = JSON.parse(localStorage.getItem('userData') || '{}');
      userData[currentUser] = userData[currentUser] || {};
      const theme = document.querySelector('input[name="theme"]:checked') ? document.querySelector('input[name="theme"]:checked').value : 'blue';
      const progressTarget = parseInt(document.getElementById('progress-target').value || '3', 10);
      userData[currentUser].settings = {
        multipleChoice: !!document.getElementById('toggle-mc').checked,
        matching: !!document.getElementById('toggle-match').checked,
        formMatch: !!document.getElementById('toggle-formmatch').checked,
        theme: theme,
        progressTarget: progressTarget
      };
      localStorage.setItem('userData', JSON.stringify(userData));
      applyTheme(theme);
      alert('Settings saved!');
    }

    document.getElementById('save-settings').addEventListener('click', saveQuestionTypeSettings);
    window.addEventListener('load', loadQuestionTypeSettings);
  </script>
  <script src="nav.js"></script>
</body>
</html>
